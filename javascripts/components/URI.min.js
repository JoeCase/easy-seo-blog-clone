/*! URI.js v1.10.2 http://medialize.github.com/URI.js/ */
(function(a,b){"object"===typeof exports?module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"===typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],b):a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains)})(this,function(G,o,B){function L(e,d){if(!(this instanceof L)){return new L(e,d)}void 0===e&&(e="undefined"!==typeof location?location.href+"":"");this.href(e);return void 0!==d?this.absoluteTo(d):this}function F(d){return d.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function i(d){return String(Object.prototype.toString.call(d)).slice(8,-1)}function I(d){return"Array"===i(d)}function m(h,e){var l,k;if(I(e)){l=0;for(k=e.length;l<k;l++){if(!m(h,e[l])){return !1}}return !0}var j=i(e);l=0;for(k=h.length;l<k;l++){if("RegExp"===j){if("string"===typeof h[l]&&h[l].match(e)){return !0}}else{if(h[l]===e){return !0}}}return !1}function f(h,e){if(!I(h)||!I(e)||h.length!==e.length){return !1}h.sort();e.sort();for(var k=0,j=h.length;k<j;k++){if(h[k]!==e[k]){return !1}}return !0}function g(d){return encodeURIComponent(d).replace(/[!'()*]/g,escape).replace(/\*/g,"%2A")}var K=L.prototype,E=Object.prototype.hasOwnProperty;L._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:L.duplicateQueryParameters}};L.duplicateQueryParameters=!1;L.protocol_expression=/^[a-z][a-z0-9-+-]*$/i;L.idn_expression=/[^a-z0-9\.-]/i;L.punycode_expression=/(xn--)/i;L.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;L.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;L.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))/ig;L.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"};L.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/;L.encode=g;L.decode=decodeURIComponent;L.iso8859=function(){L.encode=escape;L.decode=unescape};L.unicode=function(){L.encode=g;L.decode=decodeURIComponent};L.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}};L.encodeQuery=function(d){return L.encode(d+"").replace(/%20/g,"+")};L.decodeQuery=function(d){return L.decode((d+"").replace(/\+/g,"%20"))};L.recodePath=function(e){e=(e+"").split("/");for(var d=0,h=e.length;d<h;d++){e[d]=L.encodePathSegment(L.decode(e[d]))}return e.join("/")};L.decodePath=function(e){e=(e+"").split("/");for(var d=0,h=e.length;d<h;d++){e[d]=L.decodePathSegment(e[d])}return e.join("/")};var H={encode:"encode",decode:"decode"},J,C=function(e,d){return function(h){return L[d](h+"").replace(L.characters[e][d].expression,function(j){return L.characters[e][d].map[j]})}};for(J in H){L[J+"PathSegment"]=C("pathname",H[J])}L.encodeReserved=C("reserved","encode");L.parse=function(e,d){var h;d||(d={});h=e.indexOf("#");-1<h&&(d.fragment=e.substring(h+1)||null,e=e.substring(0,h));h=e.indexOf("?");-1<h&&(d.query=e.substring(h+1)||null,e=e.substring(0,h));"//"===e.substring(0,2)?(d.protocol="",e=e.substring(2),e=L.parseAuthority(e,d)):(h=e.indexOf(":"),-1<h&&(d.protocol=e.substring(0,h),d.protocol&&!d.protocol.match(L.protocol_expression)?d.protocol=void 0:"file"===d.protocol?e=e.substring(h+3):"//"===e.substring(h+1,h+3)?(e=e.substring(h+3),e=L.parseAuthority(e,d)):(e=e.substring(h+1),d.urn=!0)));d.path=e;return d};L.parseHost=function(h,e){var k=h.indexOf("/"),j;-1===k&&(k=h.length);"["===h.charAt(0)?(j=h.indexOf("]"),e.hostname=h.substring(1,j)||null,e.port=h.substring(j+2,k)||null):h.indexOf(":")!==h.lastIndexOf(":")?(e.hostname=h.substring(0,k)||null,e.port=null):(j=h.substring(0,k).split(":"),e.hostname=j[0]||null,e.port=j[1]||null);e.hostname&&"/"!==h.substring(k).charAt(0)&&(k++,h="/"+h);return h.substring(k)||"/"};L.parseAuthority=function(e,d){e=L.parseUserinfo(e,d);return L.parseHost(e,d)};L.parseUserinfo=function(e,d){var j=e.indexOf("@"),h=e.indexOf("/");-1<j&&(-1===h||j<h)?(h=e.substring(0,j).split(":"),d.username=h[0]?L.decode(h[0]):null,h.shift(),d.password=h[0]?L.decode(h.join(":")):null,e=e.substring(j+1)):(d.username=null,d.password=null);return e};L.parseQuery=function(h){if(!h){return{}}h=h.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"");if(!h){return{}}var d={};h=h.split("&");for(var n=h.length,k,j,l=0;l<n;l++){k=h[l].split("="),j=L.decodeQuery(k.shift()),k=k.length?L.decodeQuery(k.join("=")):null,d[j]?("string"===typeof d[j]&&(d[j]=[d[j]]),d[j].push(k)):d[j]=k}return d};L.build=function(e){var d="";e.protocol&&(d+=e.protocol+":");if(!e.urn&&(d||e.hostname)){d+="//"}d+=L.buildAuthority(e)||"";"string"===typeof e.path&&("/"!==e.path.charAt(0)&&"string"===typeof e.hostname&&(d+="/"),d+=e.path);"string"===typeof e.query&&e.query&&(d+="?"+e.query);"string"===typeof e.fragment&&e.fragment&&(d+="#"+e.fragment);return d};L.buildHost=function(e){var d="";if(e.hostname){L.ip6_expression.test(e.hostname)?d=e.port?d+("["+e.hostname+"]:"+e.port):d+e.hostname:(d+=e.hostname,e.port&&(d+=":"+e.port))}else{return""}return d};L.buildAuthority=function(d){return L.buildUserinfo(d)+L.buildHost(d)};L.buildUserinfo=function(e){var d="";e.username&&(d+=L.encode(e.username),e.password&&(d+=":"+L.encode(e.password)),d+="@");return d};L.buildQuery=function(j,h){var p="",l,k,n,d;for(k in j){if(E.call(j,k)&&k){if(I(j[k])){l={};n=0;for(d=j[k].length;n<d;n++){void 0!==j[k][n]&&void 0===l[j[k][n]+""]&&(p+="&"+L.buildQueryParameter(k,j[k][n]),!0!==h&&(l[j[k][n]+""]=!0))}}else{void 0!==j[k]&&(p+="&"+L.buildQueryParameter(k,j[k]))}}}return p.substring(1)};L.buildQueryParameter=function(e,d){return L.encodeQuery(e)+(null!==d?"="+L.encodeQuery(d):"")};L.addQuery=function(e,d,j){if("object"===typeof d){for(var h in d){E.call(d,h)&&L.addQuery(e,h,d[h])}}else{if("string"===typeof d){void 0===e[d]?e[d]=j:("string"===typeof e[d]&&(e[d]=[e[d]]),I(j)||(j=[j]),e[d]=e[d].concat(j))}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}};L.removeQuery=function(j,h,p){var l;if(I(h)){p=0;for(l=h.length;p<l;p++){j[h[p]]=void 0}}else{if("object"===typeof h){for(l in h){E.call(h,l)&&L.removeQuery(j,l,h[l])}}else{if("string"===typeof h){if(void 0!==p){if(j[h]===p){j[h]=void 0}else{if(I(j[h])){l=j[h];var k={},n,d;if(I(p)){n=0;for(d=p.length;n<d;n++){k[p[n]]=!0}}else{k[p]=!0}n=0;for(d=l.length;n<d;n++){void 0!==k[l[n]]&&(l.splice(n,1),d--,n--)}j[h]=l}}}else{j[h]=void 0}}else{throw new TypeError("URI.addQuery() accepts an object, string as the first parameter")}}}};L.hasQuery=function(e,d,k,j){if("object"===typeof d){for(var h in d){if(E.call(d,h)&&!L.hasQuery(e,h,d[h])){return !1}}return !0}if("string"!==typeof d){throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter")}switch(i(k)){case"Undefined":return d in e;case"Boolean":return e=Boolean(I(e[d])?e[d].length:e[d]),k===e;case"Function":return !!k(e[d],d,e);case"Array":return !I(e[d])?!1:(j?m:f)(e[d],k);case"RegExp":return !I(e[d])?Boolean(e[d]&&e[d].match(k)):!j?!1:m(e[d],k);case"Number":k=String(k);case"String":return !I(e[d])?e[d]===k:!j?!1:m(e[d],k);default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}};L.commonPath=function(h,e){var k=Math.min(h.length,e.length),j;for(j=0;j<k;j++){if(h.charAt(j)!==e.charAt(j)){j--;break}}if(1>j){return h.charAt(0)===e.charAt(0)&&"/"===h.charAt(0)?"/":""}if("/"!==h.charAt(j)||"/"!==e.charAt(j)){j=h.substring(0,j).lastIndexOf("/")}return h.substring(0,j+1)};L.withinString=function(e,d){return e.replace(L.find_uri_expression,d)};L.ensureValidHostname=function(d){if(d.match(L.invalid_hostname_characters)){if(!G){throw new TypeError("Hostname '"+d+"' contains characters other than [A-Z0-9.-] and Punycode.js is not available")}if(G.toASCII(d).match(L.invalid_hostname_characters)){throw new TypeError("Hostname '"+d+"' contains characters other than [A-Z0-9.-]")}}};K.build=function(d){if(!0===d){this._deferred_build=!0}else{if(void 0===d||this._deferred_build){this._string=L.build(this._parts),this._deferred_build=!1}}return this};K.clone=function(){return new L(this)};K.valueOf=K.toString=function(){return this.build(!1)._string};H={protocol:"protocol",username:"username",password:"password",hostname:"hostname",port:"port"};C=function(d){return function(e,h){if(void 0===e){return this._parts[d]||""}this._parts[d]=e;this.build(!h);return this}};for(J in H){K[J]=C(H[J])}H={query:"?",fragment:"#"};C=function(e,d){return function(j,h){if(void 0===j){return this._parts[e]||""}null!==j&&(j+="",j.charAt(0)===d&&(j=j.substring(1)));this._parts[e]=j;this.build(!h);return this}};for(J in H){K[J]=C(J,H[J])}H={search:["?","query"],hash:["#","fragment"]};C=function(e,d){return function(k,j){var h=this[e](k,j);return"string"===typeof h&&h.length?d+h:h}};for(J in H){K[J]=C(H[J][1],H[J][0])}K.pathname=function(e,d){if(void 0===e||!0===e){var h=this._parts.path||(this._parts.urn?"":"/");return e?L.decodePath(h):h}this._parts.path=e?L.recodePath(e):"/";this.build(!d);return this};K.path=K.pathname;K.href=function(e,d){var k;if(void 0===e){return this.toString()}this._string="";this._parts=L._parts();var j=e instanceof L,h="object"===typeof e&&(e.hostname||e.path);!j&&(h&&void 0!==e.pathname)&&(e=e.toString());if("string"===typeof e){this._parts=L.parse(e,this._parts)}else{if(j||h){for(k in j=j?e._parts:e,j){E.call(this._parts,k)&&(this._parts[k]=j[k])}}else{throw new TypeError("invalid input")}}this.build(!d);return this};K.is=function(t){var s=!1,r=!1,p=!1,n=!1,q=!1,d=!1,k=!1,l=!this._parts.urn;this._parts.hostname&&(l=!1,r=L.ip4_expression.test(this._parts.hostname),p=L.ip6_expression.test(this._parts.hostname),s=r||p,q=(n=!s)&&B&&B.has(this._parts.hostname),d=n&&L.idn_expression.test(this._parts.hostname),k=n&&L.punycode_expression.test(this._parts.hostname));switch(t.toLowerCase()){case"relative":return l;case"absolute":return !l;case"domain":case"name":return n;case"sld":return q;case"ip":return s;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return p;case"idn":return d;case"url":return !this._parts.urn;case"urn":return !!this._parts.urn;case"punycode":return k}return null};var c=K.protocol,b=K.port,a=K.hostname;K.protocol=function(e,d){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,""),e.match(/[^a-zA-z0-9\.+-]/))){throw new TypeError("Protocol '"+e+"' contains characters other than [A-Z0-9.+-]")}return c.call(this,e,d)};K.scheme=K.protocol;K.port=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),e.match(/[^0-9]/)))){throw new TypeError("Port '"+e+"' contains characters other than [0-9]")}return b.call(this,e,d)};K.hostname=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0!==e){var h={};L.parseHost(e,h);e=h.hostname}return a.call(this,e,d)};K.host=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){return this._parts.hostname?L.buildHost(this._parts):""}L.parseHost(e,this._parts);this.build(!d);return this};K.authority=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){return this._parts.hostname?L.buildAuthority(this._parts):""}L.parseAuthority(e,this._parts);this.build(!d);return this};K.userinfo=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){if(!this._parts.username){return""}var h=L.buildUserinfo(this._parts);return h.substring(0,h.length-1)}"@"!==e[e.length-1]&&(e+="@");L.parseUserinfo(e,this._parts);this.build(!d);return this};K.resource=function(e,d){var h;if(void 0===e){return this.path()+this.search()+this.hash()}h=L.parse(e);this._parts.path=h.path;this._parts.query=h.query;this._parts.fragment=h.fragment;this.build(!d);return this};K.subdomain=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""}var h=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,h)||""}h=this._parts.hostname.length-this.domain().length;h=this._parts.hostname.substring(0,h);h=RegExp("^"+F(h));e&&"."!==e.charAt(e.length-1)&&(e+=".");e&&L.ensureValidHostname(e);this._parts.hostname=this._parts.hostname.replace(h,e);this.build(!d);return this};K.domain=function(e,d){if(this._parts.urn){return void 0===e?"":this}"boolean"===typeof e&&(d=e,e=void 0);if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""}var h=this._parts.hostname.match(/\./g);if(h&&2>h.length){return this._parts.hostname}h=this._parts.hostname.length-this.tld(d).length-1;h=this._parts.hostname.lastIndexOf(".",h-1)+1;return this._parts.hostname.substring(h)||""}if(!e){throw new TypeError("cannot set domain empty")}L.ensureValidHostname(e);!this._parts.hostname||this.is("IP")?this._parts.hostname=e:(h=RegExp(F(this.domain())+"$"),this._parts.hostname=this._parts.hostname.replace(h,e));this.build(!d);return this};K.tld=function(e,d){if(this._parts.urn){return void 0===e?"":this}"boolean"===typeof e&&(d=e,e=void 0);if(void 0===e){if(!this._parts.hostname||this.is("IP")){return""}var h=this._parts.hostname.lastIndexOf("."),h=this._parts.hostname.substring(h+1);return !0!==d&&B&&B.list[h.toLowerCase()]?B.get(this._parts.hostname)||h:h}if(e){if(e.match(/[^a-zA-Z0-9-]/)){if(B&&B.is(e)){h=RegExp(F(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(h,e)}else{throw new TypeError("TLD '"+e+"' contains characters other than [A-Z0-9]")}}else{if(!this._parts.hostname||this.is("IP")){throw new ReferenceError("cannot set TLD on non-domain host")}h=RegExp(F(this.tld())+"$");this._parts.hostname=this._parts.hostname.replace(h,e)}}else{throw new TypeError("cannot set TLD empty")}this.build(!d);return this};K.directory=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname){return""}if("/"===this._parts.path){return"/"}var h=this._parts.path.length-this.filename().length-1,h=this._parts.path.substring(0,h)||(this._parts.hostname?"/":"");return e?L.decodePath(h):h}h=this._parts.path.length-this.filename().length;h=this._parts.path.substring(0,h);h=RegExp("^"+F(h));this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e));e&&"/"!==e.charAt(e.length-1)&&(e+="/");e=L.recodePath(e);this._parts.path=this._parts.path.replace(h,e);this.build(!d);return this};K.filename=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path){return""}var j=this._parts.path.lastIndexOf("/"),j=this._parts.path.substring(j+1);return e?L.decodePathSegment(j):j}j=!1;"/"===e.charAt(0)&&(e=e.substring(1));e.match(/\.?\//)&&(j=!0);var h=RegExp(F(this.filename())+"$");e=L.recodePath(e);this._parts.path=this._parts.path.replace(h,e);j?this.normalizePath(d):this.build(!d);return this};K.suffix=function(e,d){if(this._parts.urn){return void 0===e?"":this}if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path){return""}var j=this.filename(),h=j.lastIndexOf(".");if(-1===h){return""}j=j.substring(h+1);j=/^[a-z0-9%]+$/i.test(j)?j:"";return e?L.decodePathSegment(j):j}"."===e.charAt(0)&&(e=e.substring(1));if(j=this.suffix()){h=e?RegExp(F(j)+"$"):RegExp(F("."+j)+"$")}else{if(!e){return this}this._parts.path+="."+L.recodePath(e)}h&&(e=L.recodePath(e),this._parts.path=this._parts.path.replace(h,e));this.build(!d);return this};K.segment=function(j,h,p){var n=this._parts.urn?":":"/",k=this.path(),l="/"===k.substring(0,1),k=k.split(n);"number"!==typeof j&&(p=h,h=j,j=void 0);if(void 0!==j&&"number"!==typeof j){throw Error("Bad segment '"+j+"', must be 0-based integer")}l&&k.shift();0>j&&(j=Math.max(k.length+j,0));if(void 0===h){return void 0===j?k:k[j]}if(null===j||void 0===k[j]){if(I(h)){k=h}else{if(h||"string"===typeof h&&h.length){""===k[k.length-1]?k[k.length-1]=h:k.push(h)}}}else{h||"string"===typeof h&&h.length?k[j]=h:k.splice(j,1)}l&&k.unshift("");return this.path(k.join(n),p)};var D=K.query;K.query=function(e,d){if(!0===e){return L.parseQuery(this._parts.query)}if("function"===typeof e){var j=L.parseQuery(this._parts.query),h=e.call(this,j);this._parts.query=L.buildQuery(h||j,this._parts.duplicateQueryParameters);this.build(!d);return this}return void 0!==e&&"string"!==typeof e?(this._parts.query=L.buildQuery(e,this._parts.duplicateQueryParameters),this.build(!d),this):D.call(this,e,d)};K.setQuery=function(h,d,l){var j=L.parseQuery(this._parts.query);if("object"===typeof h){for(var k in h){E.call(h,k)&&(j[k]=h[k])}}else{if("string"===typeof h){j[h]=void 0!==d?d:null}else{throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")}}this._parts.query=L.buildQuery(j,this._parts.duplicateQueryParameters);"string"!==typeof h&&(l=d);this.build(!l);return this};K.addQuery=function(e,d,j){var h=L.parseQuery(this._parts.query);L.addQuery(h,e,void 0===d?null:d);this._parts.query=L.buildQuery(h,this._parts.duplicateQueryParameters);"string"!==typeof e&&(j=d);this.build(!j);return this};K.removeQuery=function(e,d,j){var h=L.parseQuery(this._parts.query);L.removeQuery(h,e,d);this._parts.query=L.buildQuery(h,this._parts.duplicateQueryParameters);"string"!==typeof e&&(j=d);this.build(!j);return this};K.hasQuery=function(e,d,j){var h=L.parseQuery(this._parts.query);return L.hasQuery(h,e,d,j)};K.setSearch=K.setQuery;K.addSearch=K.addQuery;K.removeSearch=K.removeQuery;K.hasSearch=K.hasQuery;K.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()};K.normalizeProtocol=function(d){"string"===typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!d));return this};K.normalizeHostname=function(d){this._parts.hostname&&(this.is("IDN")&&G?this._parts.hostname=G.toASCII(this._parts.hostname):this.is("IPv6")&&o&&(this._parts.hostname=o.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!d));return this};K.normalizePort=function(d){"string"===typeof this._parts.protocol&&this._parts.port===L.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!d));return this};K.normalizePath=function(h){if(this._parts.urn||!this._parts.path||"/"===this._parts.path){return this}var d,l=this._parts.path,j,k;"/"!==l.charAt(0)&&("."===l.charAt(0)&&l.substring(0,l.indexOf("/")),d=!0,l="/"+l);for(l=l.replace(/(\/(\.\/)+)|\/{2,}/g,"/");;){j=l.indexOf("/../");if(-1===j){break}else{if(0===j){l=l.substring(3);break}}k=l.substring(0,j).lastIndexOf("/");-1===k&&(k=j);l=l.substring(0,k)+l.substring(j+3)}d&&this.is("relative")&&(l=l.substring(1));l=L.recodePath(l);this._parts.path=l;this.build(!h);return this};K.normalizePathname=K.normalizePath;K.normalizeQuery=function(d){"string"===typeof this._parts.query&&(this._parts.query.length?this.query(L.parseQuery(this._parts.query)):this._parts.query=null,this.build(!d));return this};K.normalizeFragment=function(d){this._parts.fragment||(this._parts.fragment=null,this.build(!d));return this};K.normalizeSearch=K.normalizeQuery;K.normalizeHash=K.normalizeFragment;K.iso8859=function(){var e=L.encode,d=L.decode;L.encode=escape;L.decode=decodeURIComponent;this.normalize();L.encode=e;L.decode=d;return this};K.unicode=function(){var e=L.encode,d=L.decode;L.encode=g;L.decode=unescape;this.normalize();L.encode=e;L.decode=d;return this};K.readable=function(){var k=this.clone();k.username("").password("").normalize();var d="";k._parts.protocol&&(d+=k._parts.protocol+"://");k._parts.hostname&&(k.is("punycode")&&G?(d+=G.toUnicode(k._parts.hostname),k._parts.port&&(d+=":"+k._parts.port)):d+=k.host());k._parts.hostname&&(k._parts.path&&"/"!==k._parts.path.charAt(0))&&(d+="/");d+=k.path(!0);if(k._parts.query){for(var r="",p=0,q=k._parts.query.split("&"),n=q.length;p<n;p++){var l=(q[p]||"").split("="),r=r+("&"+L.decodeQuery(l[0]).replace(/&/g,"%26"));void 0!==l[1]&&(r+="="+L.decodeQuery(l[1]).replace(/&/g,"%26"))}d+="?"+r.substring(1)}return d+=k.hash()};K.absoluteTo=function(h){var d=this.clone(),l=["protocol","username","password","hostname","port"],j,k;if(this._parts.urn){throw Error("URNs do not have any generally defined hierachical components")}h instanceof L||(h=new L(h));d._parts.protocol||(d._parts.protocol=h._parts.protocol);if(this._parts.hostname){return d}j=0;for(k;k=l[j];j++){d._parts[k]=h._parts[k]}l=["query","path"];j=0;for(k;k=l[j];j++){!d._parts[k]&&h._parts[k]&&(d._parts[k]=h._parts[k])}"/"!==d.path().charAt(0)&&(h=h.directory(),d._parts.path=(h?h+"/":"")+d._parts.path,d.normalizePath());d.build();return d};K.relativeTo=function(h){var d=this.clone(),p=["protocol","username","password","hostname","port"],n;if(d._parts.urn){throw Error("URNs do not have any generally defined hierachical components")}h instanceof L||(h=new L(h));if("/"!==d.path().charAt(0)||"/"!==h.path().charAt(0)){throw Error("Cannot calculate common path from non-relative URLs")}n=L.commonPath(d.path(),h.path());for(var l=0,k;k=p[l];l++){d._parts[k]=null}if("/"===n){return d}if(!n){return this.clone()}h=h.directory();p=d.directory();if(h===p){return d._parts.path=d.filename(),d.build()}h.substring(n.length);p=p.substring(n.length);if(h+"/"===n){return p&&(p+="/"),d._parts.path=p+d.filename(),d.build()}p="../";n=RegExp("^"+F(n));for(h=h.replace(n,"/").match(/\//g).length-1;h--;){p+="../"}d._parts.path=d._parts.path.replace(n,p);return d.build()};K.equals=function(j){var d=this.clone();j=new L(j);var p={},n={},l={},k;d.normalize();j.normalize();if(d.toString()===j.toString()){return !0}p=d.query();n=j.query();d.query("");j.query("");if(d.toString()!==j.toString()||p.length!==n.length){return !1}p=L.parseQuery(p);n=L.parseQuery(n);for(k in p){if(E.call(p,k)){if(I(p[k])){if(!f(p[k],n[k])){return !1}}else{if(p[k]!==n[k]){return !1}}l[k]=!0}}for(k in n){if(E.call(n,k)&&!l[k]){return !1}}return !0};K.duplicateQueryParameters=function(d){this._parts.duplicateQueryParameters=!!d;return this};return L});