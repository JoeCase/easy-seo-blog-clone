(function(e,c,a,g){var d="ColorPicker",f={colorPickerTypes:{Simple:"SimpleColorPicker",Advanced:"AdvancedColorPicker"},colorPickerTabs:{Simple:"Site colors",Advanced:"All colors"},startWithColor:"#897185",ColorPickers:{Simple:{},Advanced:{}},preview:'<span id="originalColor"></span><span id="selectedColor"></span>',actions:'<button id="cancelSelection" class="btn btn-small gray">Cancel</button><button id="selectColor" class="btn btn-small blue">OK</button>'};function b(i,h){this.$el=e(i);this.options=e.extend({},f,h);this.options=e.extend({},this.options,{title:"Color Picker",html:true,content:'<div id="colorPicker"></div>',template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><div class="popover-header"><h5 class="popover-title"></h5><div class="popover-close"><span class="popover-close-x"></span></div></div><div class="popover-content"></div></div></div>'});this._defaults=f;this._name=d;this.init("popover",this.$el,this.options);this.createColoredElm();e(a).bind("click."+this.type,function(j){this.clearPopovers()}.bind(this))}b.prototype=e.extend({},e.fn.popover.Constructor.prototype,{constructor:b,_data:{},createColoredElm:function(){var h=e("<span>").addClass("inner");h.css("background-color",this.options.startWithColor);this.$el.parent().append(h);this.$el.addClass("color-selector")},toggle:function(h){var i=this.tip();if(!(i.hasClass("in"))){this.clearPopovers();this.show()}else{this.hide()}this.$el.toggleClass("active");this.$el.toggleClass("up");this.$el.removeClass("over");e("#picker-main").css("padding-top","12px");e(".popover").css("width",214+"px");return false},show:function(){var l,j,p,i,o,k,q;if(this.hasContent()&&this.enabled){l=this.tip();this.setContent();if(this.options.animation){l.addClass("fade")}k=typeof this.options.placement=="function"?this.options.placement.call(this,l[0],this.$element[0]):this.options.placement;j=/in/.test(k);l.detach().css({top:0,left:0,display:"block"}).insertAfter(this.$element);p=this.getPosition(j);i=l[0].offsetWidth;o=l[0].offsetHeight;switch(j?k.split(" ")[1]:k){case"bottom":q={top:p.top+p.height,left:p.left+p.width/2-i/2};break;case"top":q={top:p.top-o,left:p.left+p.width/2-i/2};break;case"left":q={top:p.top+p.height/2-o/2,left:p.left-i};break;case"right":var h=e(c).height();var r=(p.top+p.height/2);var m=o/2;var s=m-(h-(r-e(c).scrollTop()));var n=50;if(s>0){r-=s+10;n+=(((s+10)/o)*100)}e(".arrow").css("top",n+"%");q={top:r-m,left:p.left+p.width};break}l.offset(q).addClass(k).addClass("in")}},clearPopovers:function(){e(".popover").each(function(){e(this).removeClass("in");e(this).remove()});e(".color-selector").each(function(){e(this).removeClass("active");e(this).removeClass("up");e(this).removeClass("over")})},setContent:function(){var j=this.tip();j.css("height","364px");var i=f.colorPickerTabs.Simple,h=this.getContent();j.find(".popover-title")[this.options.html?"html":"text"](i);j.find(".popover-content")[this.options.html?"html":"text"](h);this.startColorPicker(j.find("#colorPicker"));j.removeClass("fade top bottom left right in")},startColorPicker:function(h){this.options.node=e("<div>",{id:"picker-main"}).appendTo(h);this.createContainers();this.renderColorPickers();this.renderButtons();this.showFirstPicker();this.renderPreview();this.bindEvents()},createContainers:function(){var h=this.options;this.paletteContainer=e("<div>",{id:"palettes"}).appendTo(h.node);this.preview=e("<div>",{id:"preview"}).appendTo(h.node).html(h.preview).css("display","none");this.createTabs();this.actions=e("<div>",{id:"actions"}).appendTo(h.node.parent())},createTabs:function(){if(Object.keys(this.options.ColorPickers).length>1){var h=e("<div>",{id:"tabs"});this._hasTabs=true;this.options.node.append(h)}},renderPreview:function(){var h=this.$el.parent().find(".inner").css("background-color");this.options.node.find("#originalColor").css("background-color",h);this.options.node.find("#selectedColor").css("background-color",h)},renderColorPickers:function(){e.each(this.options.ColorPickers,function(j,k){var h=this.options.colorPickerTypes[j];var l=this.options.ColorPickers[j];l.wrapperId="colorpicker_"+new Date().getTime();l.initColor=this.$el.parent().find(".inner").css("background-color");var i=e("<div>",{id:l.wrapperId}).appendTo(this.options.node.find("#palettes"));i[h](l);i.hide();this._data[j]={options:l,view:this.$el,type:j,self:this};if(this._hasTabs){e("<a>",{}).html(this.options.colorPickerTabs[j]).appendTo(this.options.node.find("#tabs")).attr("picker_id",l.wrapperId).bind("click",{pickerId:l.wrapperId,type:j,self:this},this.onTabSelect)}}.bind(this))},onTabSelect:function(h){if(e(h.target).hasClass("active")){return}var i=e("#palettes").children();this.$target=e(h.target);e.each(i,function(k){e(i[k]).hide();if(this.$target.attr("picker_id")!=e(i[k]).attr("id")){this.$target.show()}}.bind(this));e("#tabs").find(".active").removeClass("active");e(h.target).addClass("active");e("#"+h.data.pickerId).fadeIn();if(h.data.type==="Advanced"){e(".popover").css("width","382px");e("#picker-main").css("padding-top","6px");e("#preview").show()}else{e(".popover").css("width","214px");e("#picker-main").css("padding-top","12px");e("#preview").hide()}e("[picker_id="+h.data.pickerId+"]").hide();e.each(e("#tabs").children(),function(l){var k=e(e("#tabs").children()[l]);if(this.$target.attr("picker_id")!=k.attr("picker_id")){k.show()}}.bind(this));var j=f.colorPickerTabs[h.data.type];h.data.self.$tip.find(".popover-title")["html"](j);return false},renderButtons:function(){e("<button>",{id:"selectColor"}).html(this.options.actions).find("button").addClass("btn btn-large").appendTo(this.actions)},bindEvents:function(){var h=this.tip();e(a).bind("colorChangedPreview",this.onColorChange.bind(this));h.bind("click",function(){return false});this.actions.find("#cancelSelection").click(function(){this.closePopover();return false}.bind(this));h.find(".popover-close").click(function(){this.closePopover();return false}.bind(this));this.actions.find("#selectColor").click(function(){var j=this.preview.find("#selectedColor").data("selected");if(!j||!j.hex){this.closePopover();return false}else{this.$el.parent().find(".inner").css("background-color",j.hex)}this.closePopover();var i={type:this.$el.attr("id"),selected_color:j.hex};this.$el.trigger("colorChanged",i);return false}.bind(this))},closePopover:function(){this.hide();this.$el.removeClass("active");this.$el.removeClass("up")},onColorChange:function(i,j){var h=this.preview.find("#selectedColor");h.css("background-color",j.hex);h.data("selected",j)},showFirstPicker:function(){e(this.paletteContainer.children()[0]).show();e(this.options.node.find("#tabs").children()[0]).hide()}});e.fn[d]=function(h){var j=false,i=null;if(arguments.length==2){j=arguments[0];i=arguments[1]}return this.each(function(){var k=e.data(this,"plugin_"+d);if(!k){return e.data(this,"plugin_"+d,new b(this,h))}else{if(j!==false){if(k.hasOwnProperty(j)){k[j]=i}}}})};e.fn[d].Constructor=b})(jQuery,window,document);